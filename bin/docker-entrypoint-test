#!/usr/bin/env bash
set -e

echo "=== Preparing Rails test database ==="
bundle exec rails db:create RAILS_ENV=test
bundle exec rails db:schema:load RAILS_ENV=test

echo "=== Running RSpec ==="
bundle exec rspec "$@"
RSPEC_EXIT=$?

echo "=== Dropping test database ==="
bundle exec rails db:drop RAILS_ENV=test || true

exit $RSPEC_EXIT